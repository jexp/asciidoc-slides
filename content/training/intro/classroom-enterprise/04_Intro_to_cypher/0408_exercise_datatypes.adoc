[canvas-image="./img/coding-sw.jpg"]
== It's your turn!

[role="canvas-caption", position="center"]
It's your turn!

++++
<div class="img-ref">
derivative of <a href="https://www.flickr.com/photos/adikos/4440682278">"Female Typing"</a> by <a href="https://www.flickr.com/photos/adikos/">Adikos</a> / <a href="http://creativecommons.org/licenses/by/2.0/">CC BY</a>
<div>
++++

== More queries

- List all organizational units of "GraphIT" and their members.
- Who is working for at least 2 organizational units?
- Find all persons with first name Eve.
- Through whom/how many persons do Alice Miller and Charlene Davis know each other?
- Explore the database. What labels do exist? How many nodes/relationships are stored?


== Organizational units of "GraphIT"

[source,cypher,options="step"]
----
MATCH (u:OrganizationalUnit)-[:PARENT*0..]->(c:LegalPerson)
OPTIONAL MATCH (p:NaturalPerson)-[:MEMBER]->u
WHERE c.canonicalName = "GraphIT"
RETURN u.name, collect(p.canonicalName) as members;
----

== Who is working for at least two units?

[source,cypher,options="step"]
----
MATCH (p:NaturalPerson)-[:MEMBER]->(u1:OrganizationalUnit),
(p:NaturalPerson)-[:MEMBER]->(u2:OrganizationalUnit)
RETURN DISTINCT p.canonicalName;
----

== Persons with first name Eve

[source,cypher,options="step"]
----
MATCH (p:NaturalPerson)
WHERE p.canonicalName =~ "Eve .*"
RETURN DISTINCT p.canonicalName;
----

== Connection from Alice to Charlene

[source,cypher,options="step"]
----
MATCH path=(p:NaturalPerson)-[:MEMBER*0..]-(p2:NaturalPerson)
WHERE p.canonicalName = "Alice Miller"
  AND p2.canonicalName = "Charlene Davis"
RETURN 
  length(filter(n IN nodes(path) WHERE "NaturalPerson" IN LABELS(n)))
----


== Connection from Alice to Charlene

[source,cypher,options="step"]
----
MATCH path=(p:NaturalPerson)-[:MEMBER*0..]-(p2:NaturalPerson)
WHERE p.canonicalName = "Alice Miller"
  AND p2.canonicalName = "Charlene Davis"
RETURN extract(n IN nodes(path) | coalesce(n.canonicalName, n.name))
----

== Connection from Alice to Charlene

[source,cypher,options="step"]
----
MATCH path=(p:NaturalPerson)-[:MEMBER*0..]-(p2:NaturalPerson)
WHERE p.canonicalName = "Alice Miller"
  AND p2.canonicalName = "Charlene Davis"
WITH 
  filter(n IN nodes(path) WHERE "NaturalPerson" IN labels(n)) 
  AS persons
RETURN extract(n IN persons | n.canonicalName)
----

`WITH` allows you to modify/filter result sets



== Explore the database

[source,cypher,options="step"]
----
MATCH (a)-[r]->(b)
WHERE labels(a) <> [] AND labels(b) <> []
RETURN DISTINCT 
  head(labels(a)) AS This, 
  type(r) AS To, 
  head(labels(b)) AS That
----